<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Invia info dispositivo</title>
</head>
<body>
  <h1>Invia info dispositivo</h1>
  <button id="sendBtn">üìç Invia posizione e info</button>
  <div id="status"></div>

<script>
const WEBHOOK_URL = "https://hook.eu1.make.com/iu8aa7aatmrxy67k2l0mc9dvud48471u";

const btn = document.getElementById("sendBtn");
const status = document.getElementById("status");

btn.addEventListener("click", () => {
  if (!navigator.geolocation) {
    status.textContent = "Geolocalizzazione non supportata.";
    return;
  }
  status.textContent = "Calcolo posizione e info‚Ä¶";

  navigator.geolocation.getCurrentPosition((pos) => {
    let data = {
      latitude: pos.coords.latitude,
      longitude: pos.coords.longitude,
      timestamp: new Date().toISOString(),
      user: "Tobia",
      userAgent: navigator.userAgent,
      platform: navigator.platform,
      language: navigator.language,
    };

    fetch('https://api64.ipify.org?format=json')
      .then(res => res.json())
      .then(ipData => {
        data.ip = ipData.ip;

        fetch(WEBHOOK_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(data),
        })
        .then(res => {
          if (res.ok) status.textContent = `‚úì Inviato con IP: ${data.ip}`;
          else status.textContent = "Errore invio.";
        })
        .catch(() => status.textContent = "Errore rete invio.");
      })
      .catch(() => {
        status.textContent = "Errore nel recupero IP.";
      });

  }, (err) => {
    status.textContent = "Errore geolocalizzazione: " + err.message;
  });
});
</script>
</body>
</html>